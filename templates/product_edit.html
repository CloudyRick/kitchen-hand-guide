{% extends "base.html" %}

{% block title %}Edit Product - Kitchen Hand Guide{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="card shadow">
            <div class="card-header bg-warning text-dark">
                <h2 class="mb-0">Edit Product</h2>
            </div>
            <div class="card-body">
                {% if !error.is_empty() %}
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <strong>Error!</strong> {{ error }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                {% endif %}

                <form action="/product/{{ product.id }}/update" method="post" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="supplier_name" class="form-label">Supplier Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="supplier_name" name="supplier_name"
                               value="{{ product.supplier_name }}" required>
                        <div class="form-text">The name of the supplier providing this product.</div>
                    </div>

                    <div class="mb-3">
                        <label for="product_name" class="form-label">Product Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="product_name" name="product_name"
                               value="{{ product.product_name }}" required>
                        <div class="form-text">The name of the product.</div>
                    </div>

                    <div class="mb-3">
                        <label for="location" class="form-label">Storage Location <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="location" name="location"
                               value="{{ product.location }}" required>
                        <div class="form-text">Where this product is stored in the kitchen.</div>
                    </div>

                    <div class="mb-3">
                        <label for="picture" class="form-label">Product Image</label>
                        {% if !product.picture_url.is_empty() %}
                        <div class="mb-2">
                            <img src="{{ product.picture_url }}" class="img-thumbnail" style="max-width: 200px;" alt="Current image">
                            <p class="text-muted small">Current image (leave empty to keep this image)</p>
                        </div>
                        {% endif %}
                        <input type="file" class="form-control" id="picture" name="picture"
                               accept="image/jpeg,image/png,image/jpg,image/webp">
                        <div class="form-text">Upload a new image to replace the current one. Max size: 20MB. Formats: JPG, PNG, WEBP</div>
                        <div id="imagePreview" class="mt-2"></div>
                    </div>

                    <div class="mb-3">
                        <label for="description" class="form-label">Description <span class="text-danger">*</span></label>
                        <textarea class="form-control" id="description" name="description" rows="5" required>{{ product.description }}</textarea>
                        <div class="form-text">Detailed information about storage, handling, and shelf life.</div>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-between">
                        <a href="/product/{{ product.id }}" class="btn btn-secondary">Cancel</a>
                        <button type="submit" class="btn btn-warning btn-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-save" viewBox="0 0 16 16">
                                <path d="M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 0-1 1v7.293l2.646-2.647a.5.5 0 0 1 .708.708l-3.5 3.5a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L7.5 9.293V2a2 2 0 0 1 2-2H14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h2.5a.5.5 0 0 1 0 1H2z"/>
                            </svg>
                            Update Product
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Image preview functionality
document.getElementById('picture').addEventListener('change', function(e) {
    const preview = document.getElementById('imagePreview');
    const file = e.target.files[0];

    if (file) {
        // Check file size (20MB = 20971520 bytes)
        if (file.size > 20971520) {
            preview.innerHTML = '<div class="alert alert-warning">File size exceeds 20MB. Please choose a smaller image.</div>';
            this.value = '';
            return;
        }

        const reader = new FileReader();
        reader.onload = function(event) {
            preview.innerHTML = '<img src="' + event.target.result + '" class="img-thumbnail" style="max-width: 300px;"><p class="text-muted small">New image preview</p>';
        };
        reader.readAsDataURL(file);
    } else {
        preview.innerHTML = '';
    }
});
</script>
{% endblock %}
